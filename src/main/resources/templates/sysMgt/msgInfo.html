<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>公告管理</title>

<link href="/css/font-awesome.css?v=4.4.0" rel="stylesheet">
<link href="/css/plugins/iCheck/custom.css" rel="stylesheet">
<link href="/css/plugins/chosen/chosen.css" rel="stylesheet">
<link href="/css/plugins/cropper/cropper.min.css" rel="stylesheet">
<link href="/css/plugins/switchery/switchery.css" rel="stylesheet">
<link href="/css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">
<link href="/css/plugins/nouslider/jquery.nouislider.css" rel="stylesheet">
<link href="/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
<link href="/css/plugins/ionRangeSlider/ion.rangeSlider.css" rel="stylesheet">
<link href="/css/plugins/ionRangeSlider/ion.rangeSlider.skinFlat.css" rel="stylesheet">
<link href="/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
<link href="/css/plugins/clockpicker/clockpicker.css" rel="stylesheet">
<link href="/css/animate.css" rel="stylesheet">
<link href="/css/style.css" rel="stylesheet">
<link href="/css/plugins/jqgrid/ui.jqgrid.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/plugins/webuploader/webuploader.css">
<link rel="stylesheet" type="text/css" href="/css/demo/webuploader-demo.css">

<script src="/js/jquery.min.js?v=2.1.4"></script>
<script src="/js/bootstrap.min.js?v=3.3.7"></script>
<!-- Chosen -->
<script src="/js/plugins/chosen/chosen.jquery.js"></script>
<!-- JSKnob -->
<script src="/js/plugins/jsKnob/jquery.knob.js"></script>
<!-- Input Mask-->
<script src="/js/plugins/jasny/jasny-bootstrap.min.js"></script>
<!-- Data picker -->
<script src="/js/plugins/datapicker/bootstrap-datepicker.js"></script>
<!-- Prettyfile -->
<script src="/js/plugins/prettyfile/bootstrap-prettyfile.js"></script>
<!-- NouSlider -->
<script src="/js/plugins/nouslider/jquery.nouislider.min.js"></script>
<!-- Switchery -->
<script src="/js/plugins/switchery/switchery.js"></script>
<!-- IonRangeSlider -->
<script src="/js/plugins/ionRangeSlider/ion.rangeSlider.min.js"></script>
<!-- iCheck -->
<script src="/js/plugins/iCheck/icheck.min.js"></script>
<!-- MENU -->
<script src="/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<!-- Clock picker -->
<script src="/js/plugins/clockpicker/clockpicker.js"></script>
<!-- Image cropper -->
<script src="/js/plugins/cropper/cropper.min.js"></script>
<script src="/js/demo/form-advanced-demo.js"></script>

<script src="/js/plugins/jqgrid/i18n/grid.locale-cn.js"></script>
<script src="/js/plugins/jqgrid/jquery.jqGrid.min.js"></script>
<script src="/js/jquery.form.min.js"></script>
<script src="/js/vendor/jquery.ui.widget.js"></script>
<script src="/js/jquery.iframe-transport.js"></script>
<script src="/js/jquery.fileupload.js"></script>
<style>

.aspan{
	float: left;
    /* margin-top: 8px; */
    background-color: #eeeeee;
    width: auto;
    min-width: 16px;
    padding: 7px 10px;
    font-weight: normal;
    line-height: 1.428571429;
    text-align: center;
    text-shadow: 0 1px 0 #fff;
    vertical-align: middle;
    background-color: #eeeeee;
    border-width: 1px 0;
    margin-left: -5px;
    margin-right: -5px;
}
.ui-jqgrid .ui-jqgrid-bdiv { 
    border-top: 1px solid #E1E1E1; 
    overflow-x: auto; 
} 
.frozen-div, .frozen-bdiv {
    background-color: #E4E6E9;/*与网页背景色一致*/ */
} 
</style>
</head>

<body class="gray-bg">
	<div class="wrapper wrapper-content animated fadeInRight" >
		<div style="float:right;">
			<button id="xxxcxxxx" class="btn btn-primary" data-toggle="modal" data-target="#myModal">新增公告</button>
			<button class="btn btn-warning" id="ccccxcccc">修改公告</button>
		</div>
        <div class="jqGrid_wrapper" style="margin-top: 40px;">
            <table id="user_list"></table>
            <div id="user_list_btn"></div>
        </div>
	</div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:90%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">公告</h4>
                </div>
                <div class="modal-body">
	            	<form method="post" id="user_form" action="/dity/feePerfMgt/ggMgt" class="form-horizontal" enctype="multipart/form-data">
	            		<div class="row">
							<label class="col-sm-1 control-label" style="text-align: right; width: 150px;">标题：</label>
                          	<div class="col-md-4">
								<input id="ID" name="ID" type="hidden">
                                <input id="CONTATE_NAME" name="CONTATE_NAME" type="text" placeholder="" class="form-control"
                                   		required="" aria-required="true">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="row">
                            <label class="col-sm-1 control-label" style="text-align: right; width: 150px;">内容：</label>
                            <div class="col-md-10">
                                <input id="ggFile" type="file" name="ggFile">
                               	<img style="margin-top: 8px; max-width: 100%;" 
                               		id="ggimg" src=""/>
                               	<input type="hidden" id="CONTATE_INFO" name="CONTATE_INFO"/>
                            </div>
                        </div>
                        <div class="modal-footer">
                        	<input id="submitBtn" value="确定" type="submit" class="btn btn-primary"/>
                           	<input id="celBtn" value="取消" type="button" class="btn btn-default"/>
		                </div>
	        		</form>
                </div>
            </div>
        </div>
    </div>
    
    
    <script type="text/javascript">
	$(document).ready(function () {
		$.jgrid.defaults.styleUI = 'Bootstrap';
		initBtn();
		initFeePerfGrid();
	});

	function initBtn(){
		//初始化上传插件
		$('#ggFile').fileupload({
			//上传地址
			url:'/dity/feePerfMgt/uploadGgImg',
			//返回格式
			dataType: 'json',
			//e：事件对象
			//data：图片上传后的对象，通过data.result.picAddr可以获取上传后的图片地址
			done: function (e, data) {
				if(data.result.O_RUNSTATUS == -1){
					alert(data.result.O_MSG);
				}else{
					$('#ggimg').attr('src',data.result.url);
					$('#CONTATE_INFO').val(data.result.url);
				}
			}
		});
		
		$("#user_form").ajaxForm(function (data) {
	        if(data.O_RUNSTATUS == 1){
	        	window.location.reload();
	        }else{
	        	alert(data.O_MSG);
	        }
	    });
		$("#celBtn").click(function (){
			window.location.reload();
		});
	}

	function initFeePerfGrid(){
		$("#user_list").jqGrid({
			url:'/dity/feePerfMgt/srchInfoTsData',
			datatype: "json",
            mtype:'post',
            height: 440,
            loadonce:true,//前台分页,页面刷新不走请求了
            rowNum:50, 
            rowList:[10,50,200],   
    	    altRows: true, 
    	    rownumbers:true,
    		multiselect: false,  
    		multiboxonly:true,
    		sortorder: "asc",     
    		autowidth:true,
    		shrinkToFit:false,  
    		autoScroll: true,
    		loadtext: "卖力加载中...",
	        colNames: ['ID','公告标题', 'CONTATE_INFO'],
	        colModel: [
	        	{name: 'ID',index: 'ID',editable: true, align :"Center",hidden:true},
	            {name: 'CONTATE_NAME',index: 'USER_NO', align :"Center",editable: true,width: 500},
	            {name: 'CONTATE_INFO',index: 'CONTATE_INFO',editable: true, align :"Center",hidden:true}
	            
	        ],
	        loadComplete: function (data) {
	          　　		/*console.log(data)*/
	      　　	},
	        pager: "#user_list_btn",
	        viewrecords: true,
	        emptyrecords: "暂无数据",//viewrecords: true时生效
	        caption: "公告列表",
	        add: true,
	        edit: true,
	        editurl :'/dity/feePerfMgt/optInfoTsData',
	        hidegrid: false
	    });
		
	    //设置操作按钮
	    $("#user_list").jqGrid('navGrid', '#user_list_btn', {
	        edit: false,
	        add: false,
	        del: false,
	        search: false
	    });
	    $("#user_list").jqGrid('navButtonAdd', '#user_list_btn',
	    		{caption:"", 
	    		buttonicon:"glyphicon glyphicon-trash", 
	    		onClickButton:function(){   
	    			var rowid = $("#user_list").getGridParam("selrow");
	    			if(rowid != null){
	    				parent.layer.confirm('确定删除所选数据？', {
		    				btn: ['确定','取消'],
		    			    shade: false //不显示遮罩
		    			}, function(){
		    				parent.layer.closeAll();
		    				var rowData = $("#user_list").getRowData(rowid);
		    				$.ajax({
		    					type:"post",
		    					url:"/dity/feePerfMgt/delGg",
		    					data : {ID: rowData.ID},
		    					dataType:"json",
		    					success:function(data){
		    						if(data.O_RUNSTATUS == 1){
		    							window.location.reload();
		    						}else{
		    							alert(data.O_MSG);
		    						}
		    					},
		    					error:function(jqXHR){
		    						alert("error："+ jqXHR.status);
		    					}
		    				});
		    			}, function(){
		    			    parent.layer.close();
		    			});
	    			}else{
	    				parent.layer.msg('请选择数据！', {shift: 6});
	    			}
	    		}, 
	    		position: "first", title:"删除所选数据", cursor: "pointer"}
	    );
	    $("#user_list").jqGrid('navButtonAdd', '#user_list_btn',
	    		{caption:"", 
	    		buttonicon:"glyphicon glyphicon-edit", 
	    		onClickButton:function(){   
	    			var rowid = $("#user_list").getGridParam("selrow");
	    			if(rowid != null){
	    				var rowData = $("#user_list").getRowData(rowid);
	    				$('#ID').val(rowData.ID);
	    				$('#CONTATE_NAME').val(rowData.CONTATE_NAME);
	    				$('#CONTATE_INFO').val(rowData.CONTATE_INFO);
	    				$('#ggimg').attr("src",rowData.CONTATE_INFO);
	    				$('#xxxcxxxx').click();
	    			}
	    		}, 
	    		position: "first", title:"修改所选数据", cursor: "pointer"}
	    );
	    $("#user_list").jqGrid('navButtonAdd', '#user_list_btn',
	    		{caption:"", 
	    		buttonicon:"glyphicon glyphicon-plus", 
	    		onClickButton:function(){   
	    			$('#xxxcxxxx').click();
	    		}, 
	    		position: "first", title:"新增公告", cursor: "pointer"}
	    );
	    
	}
    //改变列宽
    $(window).bind('resize', function () {
        var width = $('.jqGrid_wrapper').width();
        $('#user_list').setGridWidth(width);
    });
	
	$("#ccccxcccc").click(function (){
    	var rowid = $("#user_list").getGridParam("selrow");
		if(rowid != null){
			var rowData = $("#user_list").getRowData(rowid);
			$('#ID').val(rowData.ID);
			$('#CONTATE_NAME').val(rowData.CONTATE_NAME);
			$('#CONTATE_INFO').val(rowData.CONTATE_INFO);
			$('#ggimg').attr("src",rowData.CONTATE_INFO);
			$('#xxxcxxxx').click();
		}else{
			parent.layer.msg('请选择数据！', {shift: 6});
		}
	});

	function closeWindow(){
		window.location.reload();
	}
</script>
</body>

</html>
