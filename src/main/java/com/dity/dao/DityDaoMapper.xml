<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.dity.dao.DityDaoMapper">
	
	<select id="qryUserList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT 
			ID,
			USER_NO,
			PASS,
			USER_NAME,
			MOBILE_NO,
			USER_ADD,
			USER_AGE,
			USER_BIRTH,
			USER_TYPE,
			STATUS,
			CASE STATUS
				WHEN 1 THEN
					'管理员'
				WHEN 2 THEN
					'普通用户'
				ELSE
					STATUS
			END STATUS_NAME,
			BANK_NO,
			WX_NO,
			ZFB_NO,
			DATE_FORMAT(CRITE_TIME,'%Y-%m-%d %H:%i:%s') CRITE_TIME,
			CRITE_USER 
		FROM T_DITY_USER T where STATUS=1
		<if test="ID != null and ID !=''">
			and ID = #{ID}
		</if>
		<if test="USER_NAME != null and USER_NAME !=''">
			and USER_NAME like concat('%',#{USER_NAME},'%')
		</if>
		<if test="USER_NO != null and USER_NO !=''">
			and USER_NO like concat('%',#{USER_NO},'%')
		</if>
	</select>
	
	<select id="getUserByNo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT * FROM T_DITY_USER T where STATUS=1 and USER_NO=#{USER_NO}
		<if test="ID != null and ID !=''">
			and ID != #{ID}
		</if>
	</select>
	
	<insert id="addUser" parameterType="java.util.HashMap">
		INSERT INTO T_DITY_USER (
				ID,
				USER_NO,
				PASS,
				USER_NAME,
				MOBILE_NO,
				USER_ADD,
				USER_AGE,
				USER_BIRTH,
				USER_TYPE,
				STATUS,
				BANK_NO,
				WX_NO,
				ZFB_NO,
				WX_IMAGE,
				ZFB_IMAGE,
				CRITE_TIME,
				CRITE_USER 
			) VALUES (
				#{ID},
				#{USER_NO},
				#{PASS},
				#{USER_NAME},
				#{MOBILE_NO},
				#{USER_ADD},
				#{USER_AGE},
				#{USER_BIRTH},
				#{USER_TYPE},
				1,
				#{BANK_NO},
				#{WX_NO},
				#{ZFB_NO},
				#{WX_IMAGE},
				#{ZFB_IMAGE},
				SYSDATE(),
				#{CRITE_USER}
			)
	</insert>
	
	<update id="editUser" parameterType="java.util.HashMap">
		UPDATE T_DITY_USER T SET 
				T.USER_NO = #{USER_NO}, 
				T.PASS = #{PASS},
				T.USER_NAME = #{USER_NAME}, 
				T.MOBILE_NO = #{MOBILE_NO}, 
				T.USER_ADD = #{USER_ADD}, 
				T.USER_AGE = #{USER_AGE}, 
				T.USER_TYPE = #{USER_TYPE}, 
				T.BANK_NO = #{BANK_NO}, 
				T.WX_NO = #{WX_NO}, 
				T.ZFB_NO = #{ZFB_NO}
				<if test="WX_IMAGE != null and WX_IMAGE !=''">
					, T.WX_IMAGE = #{WX_IMAGE}
				</if>
				<if test="ZFB_IMAGE != null and ZFB_IMAGE !=''">
					, T.ZFB_IMAGE = #{ZFB_IMAGE}
				</if>
			WHERE T.ID = #{ID}
	</update>
	
	<delete id="delUser" parameterType="java.util.HashMap">
		DELETE FROM T_DITY_USER WHERE ID = #{ID}
	</delete>
		
	<insert id="addRottn" parameterType="java.util.HashMap">
		INSERT INTO t_dity_rottn_chrt (
			ID,
			IMAGE_ORDER,
			IMAGE_NAME,
			IMAGE
		)select #{ID},IFNULL((SELECT max(IMAGE_ORDER) FROM t_dity_rottn_chrt ), 0 ) +1,
					#{IMAGE_NAME},#{IMAGE} from dual
	</insert>
	
	<select id="qryRottnChrt" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT ID,IMAGE_ORDER,IMAGE_NAME FROM T_DITY_ROTTN_CHRT where 1=1
		order by IMAGE_ORDER
	</select>
	
	<select id="qryRottnChrtById" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT * FROM T_DITY_ROTTN_CHRT where ID = #{ID}
	</select>
	
	<delete id="delItton" parameterType="java.util.HashMap">
		DELETE FROM T_DITY_ROTTN_CHRT WHERE ID = #{ID}
	</delete>
	
	<update id="editIttonOrder" parameterType="java.util.HashMap">
		UPDATE T_DITY_ROTTN_CHRT SET 
				IMAGE_ORDER = #{IMAGE_ORDER}
			WHERE ID = #{ID}
	</update>
	
	
	<select id="qryGoodsMsList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT
			ID,
			NAME,
			PRICE,
			INTRDCT,
			OWN_ACNT,
			BUY_TIME,
			WT_TIME,
			BUY_DATE,
			WT_DATE,
			STATUS,
			CASE STATUS
				WHEN 0 THEN
					'下架'
				WHEN 1 THEN
					'正常'
				ELSE
					STATUS
			END STATUS_NAME,
		 	DATE_FORMAT(CRITE_TIME,'%Y-%m-%d %H:%i:%s') CRITE_TIME,
		 	CRITE_USER
		FROM T_DITY_GOODS_MS T
			WHERE 1 = 1
		<if test="ID != null and ID !=''">
			and ID = #{ID}
		</if>
		<if test="NAME != null and NAME !=''">
			and NAME like concat('%',#{NAME},'%')
		</if>
	</select>
	
	<select id="getGoodsMsByID" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT * FROM T_DITY_GOODS_MS T where ID=#{ID}
	</select>
	
	<insert id="addGoodsMs" parameterType="java.util.HashMap">
		INSERT INTO T_DITY_GOODS_MS (
				ID,
				NAME,
				PRICE,
				INTRDCT,
				OWN_ACNT,
				IMAGE,
				STATUS,
				BUY_TIME,
				WT_TIME,
				BUY_DATE,
				WT_DATE,
				CRITE_TIME,
				CRITE_USER
			) VALUES (
				#{ID},
				#{NAME},
				#{PRICE},
				#{INTRDCT},
				null,
				#{IMAGE},
				1,
				#{BUY_TIME},
				#{WT_TIME},
				#{BUY_DATE},
				#{WT_DATE},
				SYSDATE(),
				#{CRITE_USER}
			)
	</insert>
	
	<update id="editGoodsMs" parameterType="java.util.HashMap">
		UPDATE T_DITY_GOODS_MS T SET 
				T.NAME = #{NAME}, 
				T.PRICE = #{PRICE},
				T.INTRDCT = #{INTRDCT}, 
				T.BUY_TIME = #{BUY_TIME}, 
				T.WT_TIME = #{WT_TIME}
				T.BUY_DATE = #{BUY_DATE}, 
				T.WT_DATE = #{WT_DATE}
				<if test="IMAGE != null and IMAGE !=''">
					, T.IMAGE = #{IMAGE}
				</if>
			WHERE T.ID = #{ID}
	</update>
	
	<delete id="delGoodsMs" parameterType="java.util.HashMap">
		DELETE FROM T_DITY_GOODS_MS WHERE ID = #{ID}
	</delete>
	
	<update id="setGoodsMsStatus" parameterType="java.util.HashMap">
		UPDATE T_DITY_GOODS_MS T SET 
				T.STATUS = #{STATUS}
			WHERE T.ID = #{ID}
	</update>
	
	
	<select id="qryGoodsList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT
			ID,
			NAME,
			PRICE,
			INTRDCT,
			GOODS_TYPE,
			OWN_ACNT,
			STATUS,
			CASE STATUS
				WHEN 0 THEN
					'下架'
				WHEN 1 THEN
					'正常'
				ELSE
					STATUS
			END STATUS_NAME,
		 	DATE_FORMAT(CRITE_TIME,'%Y-%m-%d %H:%i:%s') CRITE_TIME,
		 	CRITE_USER
		FROM T_DITY_GOODS T
			WHERE 1 = 1
		<if test="ID != null and ID !=''">
			and ID = #{ID}
		</if>
		<if test="NAME != null and NAME !=''">
			and NAME like concat('%',#{NAME},'%')
		</if>
	</select>
	
	<select id="getGoodsByID" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT * FROM T_DITY_GOODS T where ID=#{ID}
	</select>
	
	<insert id="addGoods" parameterType="java.util.HashMap">
		INSERT INTO T_DITY_GOODS (
				ID,
				NAME,
				PRICE,
				INTRDCT,
				GOODS_TYPE,
				OWN_ACNT,
				STATUS,
				IMAGE,
				CRITE_TIME,
				CRITE_USER
			) VALUES (
				#{ID},
				#{NAME},
				#{PRICE},
				#{INTRDCT},
				#{GOODS_TYPE},
				null,
				1,
				#{IMAGE},
				SYSDATE(),
				#{CRITE_USER}
			)
	</insert>
	
	<update id="editGoods" parameterType="java.util.HashMap">
		UPDATE T_DITY_GOODS T SET 
				T.NAME = #{NAME}, 
				T.PRICE = #{PRICE},
				T.INTRDCT = #{INTRDCT}, 
				T.GOODS_TYPE = #{OWN_ACNT}, 
				<if test="IMAGE != null and IMAGE !=''">
					, T.IMAGE = #{IMAGE}
				</if>
			WHERE T.ID = #{ID}
	</update>
	
	<delete id="delGoods" parameterType="java.util.HashMap">
		DELETE FROM T_DITY_GOODS WHERE ID = #{ID}
	</delete>
	
	<update id="setGoodsStatus" parameterType="java.util.HashMap">
		UPDATE T_DITY_GOODS T SET 
				T.STATUS = #{STATUS}
			WHERE T.ID = #{ID}
	</update>
</mapper>